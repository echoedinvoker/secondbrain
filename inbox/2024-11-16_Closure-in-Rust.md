---
date: 2024-11-16
type: fact
aliases:
  -
hubs:
  - "[[RUST]]"
---

# Closure in Rust

ğŸ’¬:
ä»€éº¼æ˜¯ closure in RUST?

ğŸ¤–:[ChatClaude-3-5-Sonnet]
åœ¨å›ç­”é€™å€‹å•é¡Œä¹‹å‰ï¼Œæˆ‘æƒ³ç¢ºèªä¸€ä¸‹æ‚¨æ˜¯å¦ç†Ÿæ‚‰å…¶ä»–ç¨‹å¼èªè¨€ä¸­çš„é–‰åŒ…ï¼ˆclosureï¼‰æ¦‚å¿µï¼Ÿé€™å°‡å¹«åŠ©æˆ‘æ›´å¥½åœ°è§£é‡‹ Rust ä¸­çš„é–‰åŒ…ã€‚

å‡è¨­æ‚¨å·²ç¶“ç†Ÿæ‚‰é–‰åŒ…çš„åŸºæœ¬æ¦‚å¿µï¼Œæˆ‘å°‡å¾ Rust çš„è§’åº¦ä¾†è§£é‡‹ï¼š

åœ¨ Rust ä¸­ï¼Œclosure æ˜¯ä¸€ç¨®åŒ¿åå‡½æ•¸ï¼Œå®ƒå¯ä»¥æ•ç²å…¶å‘¨åœç’°å¢ƒä¸­çš„è®Šé‡ã€‚Rust çš„é–‰åŒ…æœ‰ä»¥ä¸‹å¹¾å€‹é‡è¦ç‰¹é»ï¼š

1. èªæ³•ï¼š
   Rust çš„é–‰åŒ…ä½¿ç”¨ || {} èªæ³•ã€‚ä¾‹å¦‚ï¼š
   ```rust
   let add_one = |x| { x + 1 };
   ```

2. é¡å‹æ¨æ–·ï¼š
   Rust ç·¨è­¯å™¨é€šå¸¸å¯ä»¥æ¨æ–·é–‰åŒ…çš„åƒæ•¸å’Œè¿”å›é¡å‹ï¼Œä½†ä¹Ÿå¯ä»¥é¡¯å¼æŒ‡å®šï¼š
   ```rust
   let add_one: fn(i32) -> i32 = |x: i32| -> i32 { x + 1 };
   ```

3. æ•ç²ç’°å¢ƒï¼š
   é–‰åŒ…å¯ä»¥æ•ç²å…¶å®šç¾©ç’°å¢ƒä¸­çš„è®Šé‡ï¼Œæœ‰ä¸‰ç¨®æ–¹å¼ï¼š
   - å€Ÿç”¨ï¼ˆ&Tï¼‰
   - å¯è®Šå€Ÿç”¨ï¼ˆ&mut Tï¼‰
   - ç²å–æ‰€æœ‰æ¬Šï¼ˆTï¼‰

4. ç‰¹å¾µï¼ˆTraitsï¼‰ï¼š
   Rust çš„é–‰åŒ…å¯¦ç¾äº† Fnã€FnMut æˆ– FnOnce ç‰¹å¾µä¹‹ä¸€ï¼Œé€™å–æ±ºæ–¼é–‰åŒ…å¦‚ä½•æ•ç²å’Œä½¿ç”¨ç’°å¢ƒä¸­çš„è®Šé‡ã€‚

5. ç§»å‹•é–‰åŒ…ï¼š
   ä½¿ç”¨ move é—œéµå­—å¯ä»¥å¼·åˆ¶é–‰åŒ…ç²å–æ•ç²è®Šé‡çš„æ‰€æœ‰æ¬Šï¼š
   ```rust
   let x = 5;
   let owns_x = move |y| x + y;
   ```

6. ç”Ÿå‘½é€±æœŸï¼š
   é–‰åŒ…çš„ç”Ÿå‘½é€±æœŸå—åˆ°å®ƒæ•ç²çš„è®Šé‡çš„ç”Ÿå‘½é€±æœŸçš„é™åˆ¶ã€‚

é€™æ˜¯ Rust ä¸­é–‰åŒ…çš„åŸºæœ¬æ¦‚å¿µã€‚æ‚¨æ˜¯å¦éœ€è¦æˆ‘æ·±å…¥è§£é‡‹æŸå€‹ç‰¹å®šæ–¹é¢ï¼Œæˆ–è€…æä¾›ä¸€äº›å¯¦éš›çš„ä»£ç¢¼ç¤ºä¾‹ä¾†èªªæ˜é€™äº›æ¦‚å¿µï¼Ÿ


ğŸ’¬:
closure å…§å®¹çš„éƒ¨ä»½åªèƒ½æœ‰ä¸€è¡Œå—ï¼Ÿ

ğŸ¤–:[ChatClaude-3-5-Sonnet]
éå¸¸æ„Ÿè¬æ‚¨çš„å•é¡Œã€‚é€™è®“æˆ‘å¯ä»¥é€²ä¸€æ­¥æ¾„æ¸… Rust ä¸­é–‰åŒ…çš„èªæ³•ã€‚

ç­”æ¡ˆæ˜¯ï¼šä¸ï¼Œé–‰åŒ…çš„å…§å®¹ä¸é™æ–¼ä¸€è¡Œã€‚é–‰åŒ…å¯ä»¥åŒ…å«å¤šè¡Œä»£ç¢¼ã€‚è®“æˆ‘è©³ç´°è§£é‡‹ä¸€ä¸‹ï¼š

1. å–®è¡Œé–‰åŒ…ï¼š
   å°æ–¼ç°¡å–®çš„è¡¨é”å¼ï¼Œå¯ä»¥ä½¿ç”¨å–®è¡Œé–‰åŒ…ï¼š
   ```rust
   let add_one = |x| x + 1;
   ```

2. å¤šè¡Œé–‰åŒ…ï¼š
   å°æ–¼æ›´è¤‡é›œçš„é‚è¼¯ï¼Œå¯ä»¥ä½¿ç”¨å¤§æ‹¬è™Ÿ {} ä¾†åŒ…å«å¤šè¡Œä»£ç¢¼ï¼š
   ```rust
   let complex_closure = |x| {
       let y = x * 2;
       let z = y + 1;
       z * z
   };
   ```

3. è¿”å›å€¼ï¼š
   - å°æ–¼å–®è¡Œé–‰åŒ…ï¼Œæœ€å¾Œçš„è¡¨é”å¼è‡ªå‹•æˆç‚ºè¿”å›å€¼ã€‚
   - å°æ–¼å¤šè¡Œé–‰åŒ…ï¼Œæœ€å¾Œä¸€å€‹è¡¨é”å¼ï¼ˆä¸å¸¶åˆ†è™Ÿï¼‰å°‡æˆç‚ºè¿”å›å€¼ã€‚
   - å¦‚æœæƒ³åœ¨ä¸­é–“è¿”å›ï¼Œå¯ä»¥ä½¿ç”¨ return é—œéµå­—ã€‚

4. é¡¯å¼è¿”å›é¡å‹ï¼š
   å¦‚æœéœ€è¦æ˜ç¢ºæŒ‡å®šè¿”å›é¡å‹ï¼Œå¯ä»¥é€™æ¨£å¯«ï¼š
   ```rust
   let typed_closure = |x: i32| -> i32 {
       let y = x * 2;
       y + 1
   };
   ```

5. è¤‡é›œé‚è¼¯ç¤ºä¾‹ï¼š
   ```rust
   let complex_logic = |x: i32, y: i32| {
       if x > y {
           println!("x is greater");
           x
       } else {
           println!("y is greater or equal");
           y
       }
   };
   ```

6. æ•ç²è®Šé‡çš„å¤šè¡Œé–‰åŒ…ï¼š
   ```rust
   let mut sum = 0;
   let accumulator = |x: i32| {
       sum += x;
       println!("Current sum: {}", sum);
       sum
   };
   ```

ç¸½ä¹‹ï¼ŒRust çš„é–‰åŒ…éå¸¸éˆæ´»ï¼Œå¯ä»¥åŒ…å«ä»»æ„è¤‡é›œçš„é‚è¼¯ï¼Œä¸é™æ–¼å–®è¡Œè¡¨é”å¼ã€‚é€™ä½¿å¾—é–‰åŒ…å¯ä»¥ç”¨æ–¼å„ç¨®å ´æ™¯ï¼Œå¾ç°¡å–®çš„æ˜ å°„æ“ä½œåˆ°è¤‡é›œçš„ç®—æ³•å¯¦ç¾ã€‚

æ‚¨æ˜¯å¦é‚„æœ‰å…¶ä»–é—œæ–¼ Rust é–‰åŒ…çš„å•é¡Œï¼Œæˆ–è€…éœ€è¦æˆ‘è§£é‡‹æŸå€‹ç‰¹å®šçš„ç”¨ä¾‹ï¼Ÿ


ğŸ’¬:
æˆ‘çœ‹ä»¥ä¸Šé¢éƒ½ assign closure çµ¦äº† binding, é€™æ¨£è·Ÿä½¿ç”¨ fn å®šç¾©å‡½æ•¸æœ‰ä»€éº¼ä¸åŒï¼Ÿ

ğŸ¤–:[ChatClaude-3-5-Sonnet]
é€™æ˜¯ä¸€å€‹éå¸¸å¥½çš„å•é¡Œï¼æ‚¨çš„è§€å¯Ÿéå¸¸æ•éŠ³ã€‚ç¢ºå¯¦ï¼Œé–‰åŒ…å’Œå‡½æ•¸æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹è™•ï¼Œä½†ä¹Ÿæœ‰é‡è¦çš„å€åˆ¥ã€‚è®“æˆ‘å€‘æ·±å…¥æ¯”è¼ƒä¸€ä¸‹é–‰åŒ…å’Œä½¿ç”¨ fn å®šç¾©çš„å‡½æ•¸ï¼š

1. èªæ³•å’Œå®šç¾©æ–¹å¼ï¼š
   - å‡½æ•¸ï¼šä½¿ç”¨ fn é—œéµå­—å®šç¾©ï¼Œæœ‰æ˜ç¢ºçš„åç¨±ã€‚
   - é–‰åŒ…ï¼šåŒ¿åçš„ï¼Œä½¿ç”¨ || èªæ³•å®šç¾©ã€‚

   ```rust
   // å‡½æ•¸
   fn add_one(x: i32) -> i32 {
       x + 1
   }

   // é–‰åŒ…
   let add_one = |x: i32| x + 1;
   ```

2. æ•ç²ç’°å¢ƒï¼š
   - å‡½æ•¸ï¼šä¸èƒ½æ•ç²å…¶å®šç¾©ç’°å¢ƒä¸­çš„è®Šé‡ã€‚
   - é–‰åŒ…ï¼šå¯ä»¥æ•ç²å®šç¾©ç’°å¢ƒä¸­çš„è®Šé‡ã€‚

   ```rust
   let y = 5;
   
   // é–‰åŒ…å¯ä»¥æ•ç² y
   let add_y = |x| x + y;

   // å‡½æ•¸ä¸èƒ½ç›´æ¥è¨ªå• y
   // fn add_y(x: i32) -> i32 { x + y }  // é€™æœƒå°è‡´ç·¨è­¯éŒ¯èª¤
   ```

3. é¡å‹æ¨æ–·ï¼š
   - å‡½æ•¸ï¼šå¿…é ˆé¡¯å¼æŒ‡å®šåƒæ•¸å’Œè¿”å›é¡å‹ã€‚
   - é–‰åŒ…ï¼šé€šå¸¸å¯ä»¥çœç•¥é¡å‹è¨»è§£ï¼Œç”±ç·¨è­¯å™¨æ¨æ–·ã€‚

4. éˆæ´»æ€§ï¼š
   - å‡½æ•¸ï¼šæ˜¯ç¨ç«‹çš„é …ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å®šç¾©å’Œä½¿ç”¨ã€‚
   - é–‰åŒ…ï¼šé€šå¸¸åœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹ç›´æ¥å®šç¾©ï¼Œæ›´é©åˆçŸ­å°çš„ã€ä¸€æ¬¡æ€§çš„æ“ä½œã€‚

5. ç‰¹å¾µå¯¦ç¾ï¼š
   - å‡½æ•¸ï¼šå¯¦ç¾äº† Fn ç‰¹å¾µã€‚
   - é–‰åŒ…ï¼šæ ¹æ“šå¦‚ä½•æ•ç²ç’°å¢ƒï¼Œå¯èƒ½å¯¦ç¾ Fnã€FnMut æˆ– FnOnce ç‰¹å¾µã€‚

6. ä½¿ç”¨å ´æ™¯ï¼š
   - å‡½æ•¸ï¼šé©ç”¨æ–¼éœ€è¦é‡è¤‡ä½¿ç”¨çš„ã€æ˜ç¢ºå‘½åçš„åŠŸèƒ½ã€‚
   - é–‰åŒ…ï¼šé©ç”¨æ–¼ä½œç‚ºåƒæ•¸å‚³éçµ¦å…¶ä»–å‡½æ•¸ï¼ˆå¦‚è¿­ä»£å™¨æ–¹æ³•ï¼‰ã€çŸ­æœŸä½¿ç”¨çš„é‚è¼¯ã€‚

7. ç”Ÿå‘½é€±æœŸå’Œå…§å­˜ç®¡ç†ï¼š
   - å‡½æ•¸ï¼šæœ‰å›ºå®šçš„ç”Ÿå‘½é€±æœŸã€‚
   - é–‰åŒ…ï¼šç”Ÿå‘½é€±æœŸå¯èƒ½å—åˆ°æ•ç²è®Šé‡çš„å½±éŸ¿ã€‚

ç¤ºä¾‹ï¼š
```rust
fn main() {
    let numbers = vec![1, 2, 3, 4, 5];
    
    // ä½¿ç”¨é–‰åŒ…ä½œç‚ºè¿­ä»£å™¨çš„åƒæ•¸
    let sum: i32 = numbers.iter().map(|&x| x * 2).sum();
    
    println!("Sum of doubled numbers: {}", sum);
    
    // ä½¿ç”¨å‡½æ•¸éœ€è¦å…ˆå®šç¾©
    fn double(x: i32) -> i32 {
        x * 2
    }
    
    let sum_using_fn: i32 = numbers.iter().map(|&x| double(x)).sum();
    
    println!("Sum of doubled numbers (using fn): {}", sum_using_fn);
}
```

ç¸½çµï¼šé›–ç„¶é–‰åŒ…å¯ä»¥è¢«è³¦å€¼çµ¦è®Šé‡ï¼Œçœ‹èµ·ä¾†åƒæ˜¯å‘½åå‡½æ•¸ï¼Œä½†å®ƒå€‘åœ¨èªæ³•ã€åŠŸèƒ½å’Œä½¿ç”¨å ´æ™¯ä¸Šæœ‰æ˜é¡¯å€åˆ¥ã€‚é–‰åŒ…æä¾›äº†æ›´å¤§çš„éˆæ´»æ€§å’Œç°¡æ½”æ€§ï¼Œç‰¹åˆ¥æ˜¯åœ¨å‡½æ•¸å¼ç·¨ç¨‹æ¨¡å¼ä¸­ã€‚

 
