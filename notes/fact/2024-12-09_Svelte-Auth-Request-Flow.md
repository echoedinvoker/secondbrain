---
date: 2024-12-09
type: fact
aliases:
  -
hubs:
  - "[[sv5]]"
---

# Svelte Auth Request Flow

In [[2024-12-09_Sign-up-Book-Nest-with-Supabase-email-provider|this topic]], we already install the `@supabase/ssr` and `@supabase/supabase-js` packages to handle the authentication flow. But not yet learned how the authentication flow works, so let's dive into it!


![sv-auth-flow.png](../assets/imgs/sv-auth-flow.png)

**1. Client Request**

The client's route request will automatically carry a cookie with authentication information for any route starting with private/, because we have already installed the `@supabase/ssr` package.

**2. hooks.server.ts**

All route requests will first go through `hooks.server.ts`, where it will first check if there is authentication information in the cookie. If there is, it will verify with Supabase and generate a session.
This is equivalent to an authentication guard, if the verification fails, it will redirect to the login page.

**3. +layout.server.ts**

Pass the session and cookie generated by 2 to `+layout.svelte`.

**4. +layout.ts**

We will create client-side Supabase client instance or server-side Supabase client instance based on the environment. And pass the session, user and Supabase client instance to the `+layout.svelte`.

**5. +layout.svelte**

Equivalent to the entry point of the front-end app, we will use context to pass the received session, user, and Supabase client instance to the entire app.


